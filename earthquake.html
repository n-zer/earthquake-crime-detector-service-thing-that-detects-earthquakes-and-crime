<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<style>
	</style>
	<title>Space Battle</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script>
		'use strict'

		var app = app || {};
		var map;

		function externalInit(){
			var mapOptions = {
					center: {lat:39.828127,lng:-98.579404},
					zoom:3
				};
			map = new google.maps.Map(document.getElementById('mapDiv'), mapOptions);
			app.main.init();
		}

		app.main = {
			map:undefined,
			init:function(){
				console.log('test');
				var mapOptions = {
					center: {lat:39.828127,lng:-98.579404},
					zoom:3
				};
				//map = new google.maps.Map(document.getElementById('mapDiv'), mapOptions);
				var now = Date.now();
				//app.main.makeRequest();
			},
			
			makeRequest:function(){
				document.querySelector("#cumulativeMagnitude").innerHTML = "Working";
				var lat = Number(document.querySelector("#lat").value);
				var long = Number(document.querySelector("#long").value);
				var rad = Number(document.querySelector("#rad").value);
				var url = 'proxy.php?filename=http://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&callback=handleData&starttime=2000-01-01&endtime='+(new Date()).toISOString()+'&latitude='+lat+'&longitude='+long+'&maxradiuskm='+rad;
				url = url.replace(/&/g,'%26');
				/*$.ajax({
					url: 'http://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=2000-01-01&endtime='+(new Date()).toISOString()+'&latitude='+lat+'&longitude='+long+'&maxradiuskm='+rad,
					type:'GET',
					success: handleData
				});*/
				var script = document.createElement('script');
				script.setAttribute('src',url);
				script.setAttribute('id','tempScript');
				document.querySelector('head').appendChild(script);
			}
		};
		function handleData(data){
				console.log('data: ');
				console.log(data);
				var cumulativeMagnitude = 0;
				data.features.forEach(function(feature){
					cumulativeMagnitude+=feature.properties.mag;
				});
				document.querySelector("#cumulativeMagnitude").innerHTML = "Cumulative magnitude: "+cumulativeMagnitude;
			}
		/*window.onload = function(){
			app.main.init();
		}*/
	</script>	
	<script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyDi79ceE9l10cj5sgapDUGQkYgDZe7iZ2s&callback=externalInit' async defer></script>
</head>
<body>
	<p id="cumulativeMagnitude"></p>
	<form>
		Lat: <input id="lat" value='37.7749'>
		Long: <input id="long" value='122.4194'>
		Radius: <input id="rad" value='500'>
	</form>
	<button onclick='app.main.makeRequest()'>Make request</button>
	<div id="mapDiv">

	</div>
</body>
</html>
